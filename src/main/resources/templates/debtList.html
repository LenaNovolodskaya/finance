<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    
    <head>
        <meta charset="UTF-8">
        <title>Долги и займы</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link th:href="@{/css/style.css}" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    </head>
    
    <body>
        <div th:replace="~{header :: header}"></div>
        
        <div class="container mt-4">
            <h1>Долги и займы</h1>

            <div class="d-flex align-items-center mb-4" style="max-width: 1200px;">
                <a href="/debt/debtAdd" class="btn btn-primary me-3" style="min-width: 250px;">
                    <i class="fas fa-plus me-1"></i> Добавить запись
                </a>

                <div class="flex-grow-1 ms-2">
                    <div class="d-flex justify-content-between p-3 rounded card-debt">
                        <div class="me-4">
                            <strong>Вам должны:
                                <span class="text-success" th:text="${#numbers.formatDecimal(totalLent, 1, 2)}">0.00</span>
                            </strong>
                        </div>
                        <div class="me-4">
                            <strong>Вы должны:
                                <span class="text-danger" th:text="${#numbers.formatDecimal(totalBorrowed, 1, 2)}">0.00</span>
                            </strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row gy-4 mb-4">
                <div class="col-12" th:each="debt : ${debts}">
                    <div class="card-home debt-card bg-white rounded-3 shadow p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="me-4">
                                        <div class="debt-icon rounded-circle p-3"
                                             th:class="${debt.isLent} ? 'bg-success' : 'bg-danger'">
                                            <i th:class="${debt.isLent} ? 'fas fa-hand-holding-usd' : 'fas fa-hand-holding'"
                                               class="fs-4 text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="h4 mb-1" th:text="${debt.contactName}"></h3>
                                        <div class="d-flex align-items-center mb-2">
                                            <span th:if="${debt.isReturned}" class="badge bg-success">Возвращено</span>
                                            <span th:unless="${debt.isReturned}"
                                                  th:class="${debt.dueDate.isBefore(T(java.time.LocalDate).now())} ? 'badge bg-danger' : 'badge bg-warning text-dark'"
                                                  th:text="${debt != null ? debtService.getDebtStatus(debt) : 'Неизвестно'}"
                                                  class="badge"></span>
                                            <small class="text-muted ms-2"
                                                   th:text="${debt.isLent} ? 'Вам должны' : 'Вы должны'"></small>
                                        </div>

                                        <div class="d-flex flex-wrap gap-3">
                                            <div>
                                                <small class="text-muted d-block">Сумма</small>
                                                <strong th:if="${debt.remainingAmount != null && debt.remainingAmount.compareTo(debt.amount) < 0}"
                                                        th:text="${#numbers.formatDecimal(debt.remainingAmount, 1, 2)} + ' (из ' + ${#numbers.formatDecimal(debt.amount, 1, 2)} + ')'"></strong>
                                                <strong th:unless="${debt.remainingAmount != null && debt.remainingAmount.compareTo(debt.amount) < 0}"
                                                        th:text="${#numbers.formatDecimal(debt.amount, 1, 2)}"></strong>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block">Дата возврата</small>
                                                <strong th:text="${debt.dueDate}"></strong>
                                            </div>
                                            <div th:if="${debt.comment != null && !debt.comment.isEmpty()}">
                                                <small class="text-muted d-block">Комментарий</small>
                                                <strong th:text="${debt.comment}"></strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex justify-content-end gap-2">
                                    <a th:href="@{/debt/partialRepayment/{id}(id=${debt.id})}"
                                       class="btn btn-outline-info" th:if="${!debt.isReturned}"
                                       title="Внести частичный платёж">
                                        <i class="fas fa-coins"></i>
                                    </a>
                                    <a th:href="@{/debt/markReturned/{id}(id=${debt.id})}"
                                       class="btn btn-outline-success" th:if="${!debt.isReturned}"
                                       title="Долг погашен">
                                        <i class="fas fa-check"></i>
                                    </a>
                                    <a th:href="@{/debt/debtEdit/{id}(id=${debt.id})}"
                                       class="btn btn-outline-primary"
                                       title="Редактировать запись">
                                         <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{/debt/debtDelete/{id}(id=${debt.id})}"
                                       class="btn btn-outline-danger"
                                       title="Удалить запись"
                                       onclick="return confirm('Удалить эту запись?')">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
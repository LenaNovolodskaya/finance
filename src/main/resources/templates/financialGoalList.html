<!DOCTYPE html>
<html lang="en" 
      xmlns = "http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    
    <head>
        <meta charset="UTF-8">
        <title>Цели</title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link th:href="@{/css/style.css}" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    </head>
    
    <body>
        <div th:replace="~{header :: header}"></div>
        
        <div class="container mt-4">
            <h1>Финансовые цели</h1>
            
            <div class="d-flex align-items-center mb-4" style="max-width: 1200px;">
                <a href="/goal/goalAdd" class="btn btn-primary me-3" style="min-width: 250px;">
                    <i class="fas fa-plus me-1"></i> Добавить цель
                </a>

                <div class="flex-grow-1 ms-3">
                    <div class="d-flex justify-content-between p-3 rounded" 
                         style="max-width: 750px; border: 1px solid #ddd; background-color: #f9f9f9; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);">
                        <div class="me-4">
                            <strong>Доходы:
                                <span class="text-success" th:text="'+' + ${#numbers.formatDecimal(incomeSum, 1, 2)}">0.00</span>
                            </strong>
                        </div>
                        <div class="me-4">
                            <strong>Расходы:
                                <span class="text-danger" th:text="'-' + ${#numbers.formatDecimal(expenseSum, 1, 2)}">0.00</span>
                            </strong>
                        </div>
                        <div>
                            <strong>Баланс:
                                <span th:class="${balance >= 0} ? 'text-success' : 'text-danger'"
                                    th:text="${#numbers.formatDecimal(balance, 1, 2)}">0.00</span>
                            </strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row gy-4 mb-4">
                <div class="col-12" th:each="goal : ${goals}">
                    <div class="card-home goal-card bg-white rounded-3 shadow p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="me-4">
                                        <div class="goal-icon bg-primary text-white rounded-circle p-3"  style="color: #4682b4;">
                                            <i class="fas fa-bullseye fs-4"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h3 class="h4 mb-1" th:text="${goal.title}"></h3>
                                        <div class="d-flex align-items-center mb-2">
                                            <span th:if="${goal.completed}" class="badge bg-success me-2">Выполнено</span>
                                            <span th:unless="${goal.completed}" class="badge bg-warning text-dark me-2">В процессе</span>
                                            <span th:if="${overdueMap.get(goal.id)}" class="badge bg-danger me-2">Просрочено</span>
                                            <small class="text-muted" th:text="'Категория: ' + ${goal.category.name}"></small>
                                        </div>
                                        
                                        <div class="progress mb-3" style="height: 10px;">
                                            <div class="progress-bar" 
                                                 th:classappend="${goal.completed} ? 'bg-success' : 'bg-primary'"
                                                 role="progressbar" 
                                                 th:attr="aria-valuenow=${progressMap.get(goal.id)}"
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100"
                                                 th:style="'width: ' + ${progressMap.get(goal.id)} + '%;'">
                                            </div>
                                        </div>
                                        
                                        <div class="d-flex flex-wrap gap-3">
                                            <div>
                                                <small class="text-muted d-block">Целевая сумма</small>
                                                <strong th:text="${#numbers.formatDecimal(goal.targetAmount, 1, 2)}"></strong>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block">Текущая сумма</small>
                                                <strong th:text="${#numbers.formatDecimal(goal.currentAmount, 1, 2)}"></strong>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block">Осталось</small>
                                                <strong th:text="${#numbers.formatDecimal(goal.targetAmount.subtract(goal.currentAmount), 1, 2)}"></strong>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block">Ежемесячно</small>
                                                <strong th:text="${#numbers.formatDecimal(goal.monthlyContribution, 1, 2)}"></strong>
                                            </div>
                                            <div>
                                                <small class="text-muted d-block">Дата цели</small>
                                                <strong th:text="${goal.targetDate}"></strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex justify-content-end gap-2">
                                    <a th:href="@{/goal/contributionAdd/{id}(id=${goal.id})}"
                                       class="btn btn-outline-primary" th:if="${!goal.completed}"
                                       title="Внести вклад">
                                        <i class="fas fa-money-bill-wave me-1"></i>
                                    </a>
                                    <a th:href="@{/goal/goalEdit/{id}(id=${goal.id})}" 
                                        class="btn btn-sm btn-outline-primary"
                                        title="Редактировать цель">
                                         <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{/goal/goalDelete/{id}(id=${goal.id})}" 
                                       class="btn btn-outline-danger"
                                       title="Удалить цель"
                                       onclick="return confirm('Удалить эту цель?')">
                                        <i class="fas fa-trash-alt"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>